import streamlit as st
import pandas as pd
import json
from datetime import datetime

# === –°–≤—è–∑—å –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –í —Å –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –ê (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ—Ñ–µ–∫—Ç—ã) ===
CRITICAL_DEFECTS_MAPPING = {
    "33 –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∫–∞–±–∏–Ω—ã –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —ç–ª–µ–∫—Ç—Ä–æ–ø–∏—Ç–∞–Ω–∏—è –ª–∏—Ñ—Ç–∞": "–ø. 3 –≥ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ê",  # –ù–µ—Ç —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
    "47 –ù–∞–ª–∏—á–∏–µ —Ä–µ–º–æ–Ω—Ç–Ω–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–π –∏–ª–∏ –¥—Ä—É–≥–æ–π –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π —Å–≤—è–∑–∏": "–ø. 3 –± –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ê",  # –ù–µ—Ç —Å–≤—è–∑–∏
    "19 –ù–∞–ª–∏—á–∏–µ —Ä–∞–±–æ—á–µ–≥–æ –∏ –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ –æ—Å–≤–µ—â–µ–Ω–∏—è –∫–∞–±–∏–Ω—ã": "–ø. 3 –≤ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ê",  # –ù–µ—Ç –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ –æ—Å–≤–µ—â–µ–Ω–∏—è
    "50 –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Ä–∞–Ω–∏—è –∏ –æ—Ç–ø–∏—Ä–∞–Ω–∏—è –¥–≤–µ—Ä–∏ —à–∞—Ö—Ç—ã...": "–ø. 4 –∞ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ê",  # –ù–∞—Ä—É—à–µ–Ω–∏–µ –∑–∞–ø–∏—Ä–∞–Ω–∏—è
    "55 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π –≥—Ä—É–∑–æ–≤, –≤—Ö–æ–¥—è—â–∏—Ö –≤ —Å–æ—Å—Ç–∞–≤ –ø—Ä–æ—Ç–∏–≤–æ–≤–µ—Å–∞...": "–ø. 4 –≤ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ê",  # –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ—Ç–∏–≤–æ–≤–µ—Å–æ–º
    "77 –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≤–∏—Ç–µ–ª–µ–π —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º": "–ø. 4 –± –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ê",  # –õ–æ–≤–∏—Ç–µ–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
    "76 –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –ª–∏—Ñ—Ç–∞...": "–ø. 4 –∞ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ê",  # –û–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å —Å–∫–æ—Ä–æ—Å—Ç–∏
    "60 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–Ω–µ—à–Ω–µ–π —É—Ç–µ—á–∫–∏ —Ä–∞–±–æ—á–µ–π –∂–∏–¥–∫–æ—Å—Ç–∏...": "–ø. 8 –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ê",  # –¢–µ—á—å –≤ –≥–∏–¥—Ä–∞–≤–ª–∏–∫–µ
    "74 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—á–∏ –º–∞—Å–ª–∞ –∏–∑ –≥–∏–¥—Ä–æ—Ü–∏–ª–∏–Ω–¥—Ä–∞...": "–ø. 8 –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ê",  # –¢–µ—á—å –ø–æ—Å–ª–µ –∏—Å–ø—ã—Ç–∞–Ω–∏–π
}

# === –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –í (–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –¢–û) ===
def get_periodic_checklist():
    return {
        "–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –æ–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è": [
            "1 –ù–∞–ª–∏—á–∏–µ –ø–∞—Å–ø–æ—Ä—Ç–∞ –ª–∏—Ñ—Ç–∞",
            "2 –ù–∞–ª–∏—á–∏–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞/–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏",
            "3 –ù–∞–ª–∏—á–∏–µ –∑–∞–∫–ª—é—á–µ–Ω–∏—è –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ª–∏—Ñ—Ç–∞, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –∏—Å—Ç–µ–∫ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π —Å—Ä–æ–∫ —Å–ª—É–∂–±—ã",
            "4 –ù–∞–ª–∏—á–∏–µ –æ—Å–≤–µ—â–µ–Ω–∏—è —ç—Ç–∞–∂–Ω—ã—Ö –ø–ª–æ—â–∞–¥–æ–∫ –ø–µ—Ä–µ–¥ –¥–≤–µ—Ä—è–º–∏ —à–∞—Ö—Ç—ã –ª–∏—Ñ—Ç–∞",
            "5 –ù–∞–ª–∏—á–∏–µ –ø—Ä–∞–≤–∏–ª –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª–∏—Ñ—Ç–æ–º",
        ],
        "–®–∞—Ö—Ç–∞ –∏ –¥–≤–µ—Ä–∏": [
            "6 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π –æ–≥—Ä–∞–∂–¥–µ–Ω–∏—è —à–∞—Ö—Ç—ã",
            "7 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π, –∫–æ—Ä—Ä–æ–∑–∏–∏ –æ–≥—Ä–∞–∂–¥–µ–Ω–∏—è –¥–≤–µ—Ä–µ–π —à–∞—Ö—Ç—ã –∏ –∫–∞–±–∏–Ω—ã",
            "8 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π –ø–æ—Ä–æ–≥–æ–≤ –∏ –æ–±—Ä–∞–º–ª–µ–Ω–∏–π –¥–≤–µ—Ä–µ–π —à–∞—Ö—Ç—ã –∏ –∫–∞–±–∏–Ω—ã",
            "11 –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–∞–∑–æ—Ä–æ–≤ –º–µ–∂–¥—É —Å–æ–º–∫–Ω—É—Ç—ã–º–∏ —Å—Ç–≤–æ—Ä–∫–∞–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–∞–∑–¥–≤–∏–∂–Ω—ã—Ö –¥–≤–µ—Ä–µ–π —à–∞—Ö—Ç—ã –∏ –∫–∞–±–∏–Ω—ã...",
            "50 –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Ä–∞–Ω–∏—è –∏ –æ—Ç–ø–∏—Ä–∞–Ω–∏—è –¥–≤–µ—Ä–∏ —à–∞—Ö—Ç—ã...",
        ],
        "–ö–∞–±–∏–Ω–∞": [
            "16 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π –æ–≥—Ä–∞–∂–¥–µ–Ω–∏—è –∫–∞–±–∏–Ω—ã (—Å—Ç–µ–Ω—ã, –ø–æ–ª, –ø–æ—Ç–æ–ª–æ–∫)",
            "19 –ù–∞–ª–∏—á–∏–µ —Ä–∞–±–æ—á–µ–≥–æ –∏ –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ –æ—Å–≤–µ—â–µ–Ω–∏—è –∫–∞–±–∏–Ω—ã",
            "47 –ù–∞–ª–∏—á–∏–µ —Ä–µ–º–æ–Ω—Ç–Ω–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–π –∏–ª–∏ –¥—Ä—É–≥–æ–π –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π —Å–≤—è–∑–∏",
            "33 –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∫–∞–±–∏–Ω—ã –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —ç–ª–µ–∫—Ç—Ä–æ–ø–∏—Ç–∞–Ω–∏—è –ª–∏—Ñ—Ç–∞",
        ],
        "–ü—Ä–æ—Ç–∏–≤–æ–≤–µ—Å –∏ —Ç—è–≥–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã": [
            "55 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π –≥—Ä—É–∑–æ–≤, –≤—Ö–æ–¥—è—â–∏—Ö –≤ —Å–æ—Å—Ç–∞–≤ –ø—Ä–æ—Ç–∏–≤–æ–≤–µ—Å–∞...",
            "57 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –Ω–æ—Ä–º –±—Ä–∞–∫–æ–≤–∫–∏ –∏ –¥–µ—Ñ–µ–∫—Ç–æ–≤ —Ç—è–≥–æ–≤—ã—Ö –∏ —É—Ä–∞–≤–Ω–æ–≤–µ—à–∏–≤–∞—é—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ª–∏—Ñ—Ç–∞",
            "58 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –Ω–æ—Ä–º –±—Ä–∞–∫–æ–≤–∫–∏ –∏ –¥–µ—Ñ–µ–∫—Ç–æ–≤ –∫–∞–Ω–∞—Ç–∞ (—Ü–µ–ø–∏, —Ä–µ–º–Ω—è) –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –ª–∏—Ñ—Ç–∞",
        ],
        "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏": [
            "76 –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –ª–∏—Ñ—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º",
            "77 –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≤–∏—Ç–µ–ª–µ–π —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º",
            "78 –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±—É—Ñ–µ—Ä–æ–≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º",
        ],
        "–ì–∏–¥—Ä–∞–≤–ª–∏–∫–∞ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)": [
            "60 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–Ω–µ—à–Ω–µ–π —É—Ç–µ—á–∫–∏ —Ä–∞–±–æ—á–µ–π –∂–∏–¥–∫–æ—Å—Ç–∏ –ø–æ –≤—Å–µ–π –¥–ª–∏–Ω–µ —Ç—Ä—É–±–æ–ø—Ä–æ–≤–æ–¥–∞...",
            "74 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—á–∏ –º–∞—Å–ª–∞ –∏–∑ –≥–∏–¥—Ä–æ—Ü–∏–ª–∏–Ω–¥—Ä–∞ –∏ —Ç—Ä—É–±–æ–ø—Ä–æ–≤–æ–¥–∞ –ø–æ—Å–ª–µ –∏—Å–ø—ã—Ç–∞–Ω–∏—è –∏—Ö –≥–µ—Ä–º–µ—Ç–∏—á–Ω–æ—Å—Ç–∏...",
        ]
        # –ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–æ –≤—Å–µ—Ö 81 –ø—É–Ω–∫—Ç–∞
    }

# === –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ì (–ß–∞—Å—Ç–∏—á–Ω—ã–π –¢–û) ===
def get_partial_checklist():
    return {
        "–ö–∞–Ω–∞—Ç–æ–≤–µ–¥—É—â–∏–π —à–∫–∏–≤ (–±–∞—Ä–∞–±–∞–Ω —Ç—Ä–µ–Ω–∏—è)": [
            "1 –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∫–∞–Ω–∞—Ç–æ–≤–µ–¥—É—â–µ–≥–æ —à–∫–∏–≤–∞... –ø–∞—Å–ø–æ—Ä—Ç—É –ª–∏—Ñ—Ç–∞",
            "2 –ö—Ä–µ–ø–ª–µ–Ω–∏–µ –∫–∞–Ω–∞—Ç–æ–≤–µ–¥—É—â–µ–≥–æ —à–∫–∏–≤–∞. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–µ—Ñ–µ–∫—Ç–æ–≤",
            "3 –ù–∞–ª–∏—á–∏–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ —Å—Ü–µ–ø–ª–µ–Ω–∏—è —Ç—è–≥–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤...",
            "4 –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥—ä–µ–º–∞ –Ω–µ–∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –∫–∞–±–∏–Ω—ã –ø—Ä–∏ –ø—Ä–æ—Ç–∏–≤–æ–≤–µ—Å–µ –Ω–∞ —Å–∂–∞—Ç–æ–º –±—É—Ñ–µ—Ä–µ",
        ],
        "–õ–æ–≤–∏—Ç–µ–ª–∏": [
            "41 –ù–∞–ª–∏—á–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è",
            "43 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π –ª–æ–≤–∏—Ç–µ–ª–µ–π",
            "44 –°—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ –ª–æ–≤–∏—Ç–µ–ª–µ–π, –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–µ—Ä–∂–∞–Ω–∏–µ –∫–∞–±–∏–Ω—ã...",
            "45 –ù–∞–ª–∏—á–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –ª–æ–≤–∏—Ç–µ–ª–µ–π...",
        ],
        # –î–æ–±–∞–≤—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —É–∑–ª—ã –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
    }

# === Streamlit UI ===
st.set_page_config(page_title="–ê–∫—Ç –æ—Å–º–æ—Ç—Ä–∞ –ª–∏—Ñ—Ç–∞ –ø–æ –ì–û–°–¢ 34583-2019", layout="wide")
st.title("üìÑ –ê–∫—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –æ—Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ª–∏—Ñ—Ç–∞")
st.markdown("–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç **–ì–û–°–¢ 34583-2019**. –ü—É–Ω–∫—Ç—ã –∏–∑ **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–π –ê, –ë, –í, –ì, –î**.")

# === –ó–∞–≥—Ä—É–∑–∫–∞ –∂—É—Ä–Ω–∞–ª–∞ ===
uploaded_file = st.file_uploader("üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∂—É—Ä–Ω–∞–ª –æ—Å–º–æ—Ç—Ä–æ–≤ (.csv)", type="csv")
if uploaded_file is not None:
    st.session_state.journal = pd.read_csv(uploaded_file)
else:
    if "journal" not in st.session_state:
        st.session_state.journal = pd.DataFrame(columns=[
            "–î–∞—Ç–∞", "–¢–∏–ø –æ—Å–º–æ—Ç—Ä–∞", "–ê–¥—Ä–µ—Å", "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è", "–§–ò–û —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞",
            "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ—Ñ–µ–∫—Ç—ã", "–î–µ—Ñ–µ–∫—Ç—ã –Ω–∏–∑–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è", "–°—Ç–∞—Ç—É—Å"
        ])

# === –û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∞–∫—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ) ===
st.header("üè¢ –û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ")
col1, col2 = st.columns(2)
with col1:
    org_name = st.text_input("–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–≤–ª–∞–¥–µ–ª—å—Ü–∞ –ª–∏—Ñ—Ç–∞)", "–£–ö '–ü—Ä–∏–º–µ—Ä'")
    city = st.text_input("–ì–æ—Ä–æ–¥", "–ú–æ—Å–∫–≤–∞")
    street = st.text_input("–£–ª–∏—Ü–∞", "–õ–µ–Ω–∏–Ω–∞")
    house = st.text_input("–î–æ–º", "10")
with col2:
    corp = st.text_input("–ö–æ—Ä–ø—É—Å", "")
    build = st.text_input("–°—Ç—Ä–æ–µ–Ω–∏–µ", "")
    entrance = st.text_input("–ü–æ–¥—ä–µ–∑–¥", "1")
    inspector_name = st.text_input("–§–ò–û —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞", "–ò–≤–∞–Ω–æ–≤ –ò.–ò.")
    inspection_date = st.date_input("–î–∞—Ç–∞ –æ—Å–º–æ—Ç—Ä–∞", datetime.today())

full_address = f"{city}, —É–ª. {street}, –¥. {house}"
if corp: full_address += f", –∫–æ—Ä–ø. {corp}"
if build: full_address += f", —Å—Ç—Ä. {build}"
if entrance: full_address += f", –ø–æ–¥—ä–µ–∑–¥ {entrance}"

# === –¢–∏–ø –æ—Å–º–æ—Ç—Ä–∞ ===
inspection_type = st.radio("üìã –¢–∏–ø –æ—Å–º–æ—Ç—Ä–∞", ["–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –¢–û", "–ß–∞—Å—Ç–∏—á–Ω—ã–π –¢–û"], horizontal=True)

critical_defects = []
minor_defects = []
status = "–î–æ–ø—É—â–µ–Ω –∫ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏"

# === –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ ===
if inspection_type == "–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –¢–û":
    st.subheader("üîç –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ—Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ–≤–∞–Ω–∏–µ")
    st.caption("–û—Ç–º–µ—Ç—å—Ç–µ **—Ç–æ–ª—å–∫–æ —Ç–µ –ø—É–Ω–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è** (–¥–µ—Ñ–µ–∫—Ç—ã).")
    
    checklist = get_periodic_checklist()
    failed_items = []
    
    for section, items in checklist.items():
        with st.expander(section, expanded=False):
            for item in items:
                if st.checkbox(f"**–î–µ—Ñ–µ–∫—Ç:** {item}", key=f"periodic_{item}"):
                    failed_items.append(item)
    
    # –ê–Ω–∞–ª–∏–∑ –¥–µ—Ñ–µ–∫—Ç–æ–≤
    for item in failed_items:
        key = item.split(". ", 1)[1] if ". " in item else item
        if key in CRITICAL_DEFECTS_MAPPING:
            critical_defects.append(f"{item} ‚Üí {CRITICAL_DEFECTS_MAPPING[key]}")
        else:
            minor_defects.append(item)
    
    if critical_defects:
        status = "–ó–ê–ü–†–ï–©–ï–ù–ê –≠–ö–°–ü–õ–£–ê–¢–ê–¶–ò–Ø"

elif inspection_type == "–ß–∞—Å—Ç–∏—á–Ω—ã–π –¢–û":
    st.subheader("üîß –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ—Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ–≤–∞–Ω–∏–µ")
    replaced_component = st.selectbox(
        "üõ†Ô∏è –ó–∞–º–µ–Ω—ë–Ω–Ω—ã–π —É–∑–µ–ª",
        list(get_partial_checklist().keys())
    )
    checklist = get_partial_checklist()[replaced_component]
    
    st.caption("–û—Ç–º–µ—Ç—å—Ç–µ **—Ç–æ–ª—å–∫–æ —Ç–µ –ø—É–Ω–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è** (–¥–µ—Ñ–µ–∫—Ç—ã).")
    failed_items = []
    for item in checklist:
        if st.checkbox(f"**–î–µ—Ñ–µ–∫—Ç:** {item}", key=f"partial_{item}"):
            failed_items.append(item)
    
    minor_defects = failed_items
    if not minor_defects:
        status = "–î–æ–ø—É—â–µ–Ω –∫ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏"
    else:
        status = "–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç–æ–≤"

# === –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–∫—Ç–∞ ===
if st.button("‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–∫—Ç –æ—Å–º–æ—Ç—Ä–∞"):
    new_entry = {
        "–î–∞—Ç–∞": inspection_date.strftime("%Y-%m-%d"),
        "–¢–∏–ø –æ—Å–º–æ—Ç—Ä–∞": inspection_type,
        "–ê–¥—Ä–µ—Å": full_address,
        "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è": org_name,
        "–§–ò–û —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞": inspector_name,
        "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ—Ñ–µ–∫—Ç—ã": "; ".join(critical_defects) if critical_defects else "–ù–µ—Ç",
        "–î–µ—Ñ–µ–∫—Ç—ã –Ω–∏–∑–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è": "; ".join(minor_defects) if minor_defects else "–ù–µ—Ç",
        "–°—Ç–∞—Ç—É—Å": status
    }
    st.session_state.journal = pd.concat([st.session_state.journal, pd.DataFrame([new_entry])], ignore_index=True)
    
    if critical_defects:
        st.error("‚ùå –≠–ö–°–ü–õ–£–ê–¢–ê–¶–ò–Ø –õ–ò–§–¢–ê –ó–ê–ü–†–ï–©–ï–ù–ê!")
        for defect in critical_defects:
            st.markdown(f"- {defect}")
    else:
        st.success("‚úÖ –ê–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω. –õ–∏—Ñ—Ç –¥–æ–ø—É—â–µ–Ω –∫ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏.")

# === –ñ—É—Ä–Ω–∞–ª ===
if not st.session_state.journal.empty:
    st.subheader("üì∞ –ñ—É—Ä–Ω–∞–ª –æ—Å–º–æ—Ç—Ä–æ–≤")
    st.dataframe(st.session_state.journal)
    csv = st.session_state.journal.to_csv(index=False, encoding='utf-8-sig')
    st.download_button("üíæ –°–∫–∞—á–∞—Ç—å –∂—É—Ä–Ω–∞–ª (.csv)", csv, "elevator_inspection_log.csv", "text/csv")
